# 소코반 게임 구현 과정

## 1단계

### 요구 사항

* Map 데이터를 입력 받고 2차원 배열에 정보를 저장한다.
  - 입력 구분
    - Stage + 번호
        - 스테이지 시작 구분
    - \# : 저장값 0
        - 벽
    - O : 저장값 1
        - 구멍
    - o : 저장값 2
        - 공
    - P : 저장값 3
        - 플레이어
    - = : 저장값 4
        - 스테이지 구분
    - " " : 저장값 -1
        - 비어있는 공간 구분. 이동 가능한 공간
    

* 배열에 저장 된 정보를 통해 각 스테이지 정보를 출력한다.

### 구현

**Map** : 스테이지 값, Map의 배열이 저장되는 2차원 배열과, Map의 정보가 저장되는 MapInfo를 필드값으로 갖는다.

**MapInfo** : Map의 상세정보. 가로크기, 세로크기, 구멍의 수, 공의 수, 플레이어 위치를 필드값으로 갖는다.

**Main** : 함수 실행을 위한 Main클래스

1. Map에 들어갈 데이터 입력받기
  - getMapData() 함수를 통해 지도에 들어갈 데이터 값을 BufferedReader에 저장하여 반환.

2. 입력받은 데이터를 2차원 배열로 저장
  - createStageMap() 함수를 통해 접근 하고자 하는 스테이지와 해당 스테이지의 Map정보를 Map객체에 저장한다.
    - 파라미터 값으로 접근하고자 하는 currentStage의 값을 받는다. 1스테이지부터 시작하여 버퍼값을 한 줄씩 읽으며 "="으로 시작하는 라인을 찾고 해당하는 경우에 Map객체의 stage값을 한 단계씩 증가 시킨다.
      - Map객체의 stage값과 파라미터 currentStage값이 일치할 경우, 요구 사항과 일치하는 저장값을 2차원 배열에 저장한다. 동시에 MapInfo에 정보를 저장한다.
      - 더 이상 읽을 버퍼값이 존재하지 않거나, 다음 Stage 구분값인 "="를 만날 경우, 함수를 종료한다.
      - 존재하지 않는 Stage의 값을 파라미터로 전달할 경우 예외 처리.

3. 각 스테이지의 정보 출력
  - viewMapInfo() 함수를 통해 Map객체에 생성되어 있는 스테이지의 Map배열과 Map정보를 출력한다.

## 2단계

### 요구 사항

- 프로그램 실행 시 스테이지2의 지도를 출력
- 간단한 프롬프트 ex) SOKOBAN> 표시
- 하나 이상의 문자를 입력받을 경우 순서대로 처리하여, 단계 별 상태를 출력
- 벽이나 공 등의 다른 물체에 부딪히면 해당 명령을 수행할 수 없습니다 라는 메세지를 출력하고, 플레이어를 움직이지 않는다.


- 입력명령
  - w: 위쪽
  - a: 왼쪽
  - s: 아래쪽
  - d: 오른쪽
  - q: 프로그램 종료
  
### 구현

**Controller** : Map객체, 이동명령 값, 이동 성공여부를 필드값으로 갖는다.

**Main -> Game** : Main클래스의 이름을 Game으로 변경.

1. Game클래스 Start() 함수의 파라미터 값으로 Stage값을 입력받아 해당 Stage의 Map객체를 반환.


2. Game클래스의 Main 함수는 UI출력을 담당한다. 이동명령 값이 'q'일 경우, loof 탈출


3. Controller클래스 생성자를 통해 Map객체, 이동명령 값을 전달하여 Map객체를 조작 및 이동 성공여부를 저장하여 Controller객체를 반환.
  - 'w' 위쪽 이동의 경우, MapInfo에서 현재 플레이어 위치를 가져오고, 해당 좌표값에서 y축 값을 -1하여 해당 위치의 2차원 배열 값이 -1(공백)인 경우에만 이동을 허용한다.
  - 's' 아래쪽 이동의 경우, MapInfo에서 현재 플레이어 위치를 가져오고, 해당 좌표값에서 y축 값을 +1하여 해당 위치의 2차원 배열 값이 -1(공백)인 경우에만 이동을 허용한다.
  - 'a' 왼쪽 이동의 경우, MapInfo에서 현재 플레이어 위치를 가져오고, 해당 좌표값에서 x축 값을 -1하여 해당 위치의 2차원 배열 값이 -1(공백)인 경우에만 이동을 허용한다.
  - 'd' 오른쪽 이동의 경우, MapInfo에서 현재 플레이어 위치를 가져오고, 해당 좌표값에서 x축 값을 +1하여 해당 위치의 2차원 배열 값이 -1(공백)인 경우에만 이동을 허용한다.

## 3단계

### 요구 사항

- 스테이지1 부터 5까지 플레이 가능한 map.txt 파일을 작성한다.
- 지도 파일 map.txt를 읽어 처리하도록 개선한다.
- 처음 시작 시 Stage 1의 지도와 프롬프트가 표시된다.
- r 명령 입력시 스테이지를 초기화 한다.
- 모든 o를 O자리에 이동시키면 클리어 화면을 표시하고 다음 스테이지로 이동한다.
- 주어진 모든 스테이지를 클리어 시 축하메시지를 출력하고 게임을 종료한다.

#### 플레이어 이동조건

- 플레이어는 o를 밀어서 이동할 수 있지만 당길 수는 없다.
- o를 O지점에 밀어 넣으면 0으로 변경된다.(저장값은 5로 설정.)
- 플레이어는 O를 통과할 수 있다.
- 플레이어는 #을 통과할 수 없다.
- 0상태의 o를 밀어내면 다시 o와 O로 분리된다.
- 플레이어가 움직일 때마다 턴수를 카운트한다.
- 상자가 두 개 연속으로 붙어있는 경우 밀 수 없다.

### 구현

- map.txt 파일 작성 후 파일 읽어오기 처리
- 게임 시작 시 1스테이지부터 시작하도록 변경
- r 명령 입력 시 진행 중인 스테이지의 맵 초기화
- O의 갯수가 0개가 될 경우, 클리어 화면 표시 후 다음 스테이지로 이동
- 5스테이지 클리어 시 축하 메시지 출력하고, 게임 종료
  
- 플레이어가 O를 통과할 수 있도록 변경
  - 플레이어가 이동한 위치가 O임을 구분할 수 있도록 해당 좌표 저장값을 6으로 설정. 표시는 그대로 P로 표시
- 플레이어가 움직일 때마다 현재 플레이어 위치의 좌표 저장값이 6인지 확인하는 로직 추가
  - 현재 좌표 저장값이 6 이라면, 이동에 성공했을 경우 이전에 있던 위치에 O생성
- 플레이어가 다음으로 이동할 위치에 o가 존재한다면, o를 플레이어가 이동한 방향으로 한 칸 이동
  - o가 이동할 위치에 o가 존재하거나, #이 존재한다면 이동불가 처리
  - o가 이동할 위치가 O일 경우, 해당 위치를 0으로 변경하고 저장값은 5로 설정한다.
- 플레이어가 이동할 위치에 0이 존재한다면, 조건 체크.
  - 플레이어가 이동한 방향 다음 칸이 0, o, #이라면 이동 불가처리
  - 이 외의 경우 0을 P로 설정하고, 플레이어가 이동한 방향 다음 칸에 o를 생성
- 플레이어가 움직일 때마다 턴수를 카운트하여 저장. 이는 r 명령 입력 시 초기화

## 4단계

### 요구 사항

- 되돌리기 기능 및 되돌리기 취소 기능
- 저장하기 불러오기 기능

### 구현

- 3단계에서 구현한 턴수를 이용하여, Map객체를 ArrayList에 저장
  - Map객체를 깊은 복사하여 저장하도록 clone()구현 Map, MapInfo, map배열 모두 깊은 복사로 생성
  - 'u' 되돌리기 입력 시, 되돌리기 횟수를 저장하는 backCount +1
  - 'U' 되돌리기 취소 입력 시, 되돌리기를 실행한 횟수가 1이상 인지 체크한 뒤, 되돌리기 취소 후 backCount -1
  
- 세이브 데이터를 저장할 saveSlot배열 생성
  - 게임의 진행 정보를 저장할 Save객체를 생성
  - 사용자에게 세이브&로드 슬롯 번호 + 입력값을 받고
    - 'S'일 경우, 게임 진행 정보를 Save객체에 담고 saveSlot에 저장 
    - 'L'일 경우, Save객체에서 게임 진행 정보를 불러온다.
  